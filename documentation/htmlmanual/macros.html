<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
  <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
  <META name="robots" content="noindex, nofollow">
  <TITLE>The macros file</TITLE>
</HEAD>
 
<BODY BGCOLOR="#FFFBF0">

<H1><A NAME="macros">The macros file</A></H1>

<P>Most users will not have to touch the macros file, unless having difficulty
in locating an error.  In this case, the memory and stack section is the thing
to change.

<P>The macros file is mostly intended for developers.  It serves several basic
functions:
<UL>
<P><LI>It allows the foo preprocessor to associate types with modules, and
allows us to use shorthand types.
<BR>Each type can also have a memory size associated with it, to help with the
memory management facility.
<P>For example, type FILE is short for type(file_type), and is associated with
the FILE module.  It takes up FILE_SIZE of memory.
<P><LI>It is a convenient way of sharing the values of scientific constants
across all modules, eg, the speed of light.
<P><LI>It allows us to implement memory and error management in a way that will
have no performance effects if turned off.
<P><LI>It allows us to easily change number kinds, such as that of real
numbers, by changing just one setting.  This also has the advantage of being
compiler independent.<BR>
eg, DBL_KIND of 4 is for single precision reals, and DBL_KIND of 8 is for
double precision reals.
<P><LI>It allows neater programming.  eg,
<DIR>
<PRE>MAT(:,:), PTR :: x</PRE>
instead of
<PRE>double precision, dimension(:,:), pointer :: x</PRE>
</DIR>
</UL>

<P><H3><A NAME="memstack">The memory and stack macros</A></H3>

<P>The memory and stack macros are good for locating errors, and ensuring the
program does not contain memory leaks, or uses too much memory.

<P>Enabling these macros does however have a high performance penalty, about a
30% reduction is speed.  Thus if you are not developing code or you can easily
solve your errors, it is probably best to have these turned off (comment out
the other version in the macros file):
<DIR><DIR><PRE>
#define STACK(X)
#define UNSTACK
#define CHECK
#define ADD_MEM(X)
#define DELETE_MEM(X)
</PRE></DIR></DIR>

<P>Enabling the macros will tell you which routine caused a memory leak or
TONTO to exceed its memory allowance, and also the exact routine where warning
or error messages were generated.  It will not however tell you where numerical
errors occurred, eg a divide by zero.  For this, you will have to use a
debugger.  To enable the macros, have them like this (comment out the other
version in the macros file):
<DIR><DIR><PRE>
#define STACK(X)          call stack_(tonto,X);
#define UNSTACK           call unstack_(tonto);
#define CHECK             call check_(tonto);
#define ADD_MEM(X)        call add_mem_(tonto,X);
#define DELETE_MEM(X)     call delete_mem_(tonto,X);
</PRE></DIR></DIR>

<P><H3><A NAME="default">The default and default_null macros</A></H3>

<P>The DEFAULT(X) and DEFAULT_NULL macros are used to define default variables
of variables and pointers in routines, respectively.  They were introduced due
to a bug in the Digital Fortran 5.0 for OSF1 compiler, which produces compiler
errors with this.

<P>For all other compilers, you should allow the setting of default values:
<DIR><DIR><PRE>
#define DEFAULT(X)         = X
#define DEFAULT_NULL       => NULL()
</PRE></DIR></DIR>

<P>If you are using the Digital Fortran 5.0 for OSF1 compiler, the
DEFAULT_NULL and DEFAULT(X) macros must be blank:
<DIR><DIR><PRE>
#define DEFAULT_NULL<br>
#define DEFAULT(X)<br>
</PRE></DIR></DIR>
The "configure" script should detect and fix this automatically whenever run.
 
<P><H3><A NAME="types">Adding new types</A></H3>
If you add a new module and type to TONTO, you will need to enter corresponding
entries in the macros file.  This is best shown by example, as it is quite
simple.  Suppose you add a new type called apple_type to the types file:
<DIR><DIR><PRE>
 type apple_type
   STR :: orchard
   DBL :: weight
   DBL :: diameter
 end
</PRE></DIR></DIR>
Then you should add these to the macros file:
<DIR><DIR><PRE>
#define APPLE              type(apple_type)
#define APPLE_SIZE         STR_SIZE+2*DBL_SIZE
</PRE></DIR></DIR>
Then you are free to define variables of APPLE in any of your modules, eg,
APPLE :: granny_smith
</BODY>
</HTML>
